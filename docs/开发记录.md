# 开发记录

## macOS 应用分发策略

### 方式一：直接构建运行（开发调试）

1. 用 Xcode 打开 `menu-stats/menu-stats.xcodeproj`
2. 选择目标设备为 "My Mac"
3. 按 `Cmd + R` 运行

### 方式二：构建后拷贝 .app（本机使用）

1. 在 Xcode 中按 `Cmd + B` 构建项目
2. 在左侧 Navigator 找到 **Products** 文件夹
3. 右键点击 `menu-stats.app` → **Show in Finder**
4. 将 `.app` 文件拷贝到 `/Applications` 目录

### 方式三：Archive 导出（正式分发）

1. **Xcode 菜单**: Product → Archive
2. 等待 Archive 完成后，Organizer 窗口会自动打开
3. 选择刚创建的 Archive，点击 **Distribute App**
4. 选择分发方式：
   - **Developer ID** - 用开发者证书签名（可分发给其他人）
   - **App Store Connect** - 提交到 Mac App Store

### 命令行构建

```bash
# 1. 设置 Xcode 开发者目录（如果未设置）
sudo xcode-select -s /Applications/Xcode.app/Contents/Developer

# 2. 创建 archive
xcodebuild -project menu-stats.xcodeproj \
  -scheme menu-stats \
  -configuration Release \
  archive \
  -archivePath build/menu-stats.xcarchive

# 3. 导出为 app（跳过签名，用于本机使用）
cat > /tmp/export_options.plist << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>method</key>
    <string>mac-application</string>
    <key>signingStyle</key>
    <string>none</string>
    <key>skipSigning</key>
    <true/>
</dict>
</plist>
EOF

xcodebuild -exportArchive \
  -archivePath build/menu-stats.xcarchive \
  -exportOptionsPlist /tmp/export_options.plist \
  -exportPath build/output

# 4. 拷贝到应用程序目录
cp -R build/output/menu-stats.app /Applications/
```

**输出位置**: `build/output/menu-stats.app`

### 安全提示处理

如果遇到"无法打开，因为无法验证开发者"的提示：

- 右键点击 app → 选择"打开" → 确认打开
- 或在 **系统设置 → 隐私与安全性** 中点击"仍要打开"

---

## 应用图标配置生成

### 注意事项

- 图标文件必须是 PNG 格式
- 确保 `Contents.json` 中每个条目都有 `filename` 字段
- 修改图标后需要 Clean Build（`Cmd + Shift + K`）再重新构建
- iOS 配置（`platform: "ios"`）对 macOS 应用无效，需要使用 `idiom: "mac"`

### 在线工具

如需生成完整尺寸的图标集，可使用：

- [appicon.co](https://appicon.co/)
- [makeappicon.com](https://makeappicon.com/)

上传 1024px 图标，选择 macOS 平台，一键生成所有尺寸。

### 脚本生成

```bash
cd /Users/actor/Documents/code/menus-stats/menu-stats/menu-stats/Assets.xcassets/AppIcon.appiconset

# 假设你的原图叫 icon_1024.png
SOURCE="StatusIcon.png"

# 生成各尺寸
sips -z 16 16 "$SOURCE" --out icon_16.png
sips -z 32 32 "$SOURCE" --out icon_32.png
sips -z 64 64 "$SOURCE" --out icon_64.png
sips -z 128 128 "$SOURCE" --out icon_128.png
sips -z 256 256 "$SOURCE" --out icon_256.png
sips -z 512 512 "$SOURCE" --out icon_512.png
sips -z 1024 1024 "$SOURCE" --out icon_1024.png
```
