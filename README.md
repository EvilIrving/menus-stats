# Light Stats

## 一、 产品概述

Light Stats 是一款常驻 macOS 状态栏的轻量级系统监控工具。它旨在为用户提供实时、克制且准确的系统状态感知，帮助用户快速了解 CPU、GPU、内存、磁盘和网络等核心指标，并能在必要时快速清理内存资源。

### 1. 设计哲学

- **快速感知**：信息触手可及，无需打开独立窗口。
- **展示克制**：固定布局，避免界面抖动；仅展示关键指标。
- **只读为主**：侧重于状态监控，仅提供必要的资源释放（清理）操作。
- **模块化设计**：基于协议和依赖注入，支持高度扩展性和可测试性。

---

## 二、 核心功能与页面

### 1. 状态栏 (Status Bar)

- **形态**：常驻系统菜单栏，由一个图标 (Logo) 和若干监控项组成。
- **布局**：采用**双行上下结构**。
  - **上方**：显示数值（如 `62%`、`99 GB`），使用 11pt 等宽数字字体。
  - **下方**：显示标签（如 `CPU`、`DISK`），使用 8pt 字体，颜色较浅。
  - **网络项**：上方显示上传速度（↑），下方显示下载速度（↓），使用 10pt 等宽字体。
- **固定宽度**：为防止数值变化导致抖动，每个格子使用固定宽度（如 CPU 26pt, Disk 46pt）。
- **动态显示**：用户可在设置中自由开关各显示项（Logo, CPU, GPU, MEM, Disk, Net, Fan）。

### 2. 弹窗面板 (Popover)

点击状态栏项后弹出，包含两个主要 Tab：

- **概览 (Overview)**：
  - 环形进度条展示 CPU、GPU、内存使用率。
  - 核心使用率列表（支持多核显示，带颜色渐变）。
  - 实时网络上传/下载曲线或数值。
  - 磁盘空间（可用/总量）及风扇转速、温度显示。
- **清理 (Cleanup)**：
  - 内存压力概览。
  - 运行中 App 列表（按内存占用降序排列）。
  - 支持正常关闭应用和强制退出应用（弹出二次确认）。

### 3. 设置页面 (Settings)

- **显示控制**：勾选/取消状态栏监控项。
- **刷新频率**：低 (5s) / 中 (2s) / 高 (1s)。
- **单位偏好**：温度（℃/℉）、网速（自动/KB/s/MB/s）。
- **多语言支持**：支持**简体中文**、**English**、**日本語**，并可跟随系统。

---

## 三、 架构设计与技术栈

### 1. 技术栈

- **语言**：Swift 5.9+
- **框架**：SwiftUI (Popover/Settings) + AppKit (Status Item/Drawing)
- **异步处理**：Combine (数据流订阅) + Swift Concurrency (async/await)
- **最低版本**：macOS 14 (Sonoma)
- **数据源**：Mach API (CPU/MEM), IOKit (GPU), SMC (Temp/Fan), getifaddrs (Network).

### 2. 核心架构模式

- **Module & Reader 模式**：每个监控维度（CPU, MEM等）有独立的数据读取器和管理类。
- **协议抽象 (Protocol-based Design)**：核心服务（如 `ProcessService`）和配置（`SettingsManaging`）均定义协议，实现调用方与具体实现的解耦。
- **依赖注入 (Dependency Injection)**：通过构造函数或字段注入实例，提升代码的可测试性。
- **统一配置 (Global Config)**：使用 `AppConfig` 集中管理全局常量（如 Top N 进程数、默认刷新率）。

---

## 四、 实现状态追踪 (Updated: 2026-01-16)

### 1. 状态栏

| 功能 | 状态 | 说明 |
|------|------|------|
| NSStatusItem 基础框架 | ✅ 已完成 | `AppDelegate` 管理 |
| 双行显示布局（值+标签） | ✅ 已完成 | `StatusBarView` 绘制 |
| 固定宽度格子（防止抖动） | ✅ 已完成 | 预设各项目宽度 |
| 动态显示项开关 | ✅ 已完成 | 设置项与 UI 联动 |
| 至少显示一项校验 | ✅ 已完成 | 防止菜单栏空白 |
| 风扇模拟旋转动画 | ❌ 未实现 | 计划中 |

### 2. Popover 弹窗

| 功能 | 状态 | 说明 |
|------|------|------|
| 双 Tab 结构 | ✅ 已完成 | 概览 / 清理 |
| 环形进度条 (RingView) | ✅ 已完成 | 支持渐变色 |
| 核心使用率列表 | ✅ 已完成 | 自动适配多核心 |
| 进程内存排序与分组 | ✅ 已完成 | `AppMemoryManager` 实现 |
| 强制退出应用功能 | ✅ 已完成 | 带二次确认 Alert |
| 10 秒自动关闭 | ❌ 未实现 | 当前仅支持点击外部关闭 |

### 3. 全局特性

| 功能 | 状态 | 说明 |
|------|------|------|
| 多语言 (i18n) | ✅ 已完成 | 中/英/日 切换 |
| 依赖注入重构 | ✅ 已完成 | 提升了核心组件的解耦 |
| 统一配置收口 (AppConfig) | ✅ 已完成 | 消除硬编码魔术字 |
| 温度单位切换 | ✅ 已完成 | 摄氏度 / 华氏度 |

---

## 五、 文件结构参考

- `Models/`: 基础数据结构（CPUInfo, DiskInfo 等）。
- `Services/`: 系统级数据采集（ProcessService, SMCInfo）。
- `ViewModels/`: 业务逻辑与状态管理（SystemMonitor, AppMemoryManager, SettingsManager）。
- `Views/`:
  - `StatusBar/`: 状态栏绘图逻辑。
  - `Popover/`: 弹窗面板组件与 Tab 视图。
  - `Settings/`: 设置页面 UI。
- `Resources/`: 国际化资源文件 (`Localizable.strings`)。
- `Utilities/`: 格式化工具与通用辅助方法。

---

## 六、 总结

Light Stats 已从一个简单的原型演进为具备生产力属性的系统工具。通过引入协议抽象和多语言支持，项目在代码质量和用户体验上达到了新的高度。未来的重点将放在交互细节的打磨（如动画、自动关闭逻辑）以及更多监控指标的覆盖上。
